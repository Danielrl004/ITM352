<!-- Author: Christopher Y. This file displays product store -->
<!-- This page is adapted from a W3 Schools Template: https://www.w3schools.com/w3css/tryw3css_templates_black.htm -->
<!DOCTYPE html>
<html>
<!-- Importing template stylesheets -->

<head>
    <title>Home</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
    <!-- Calling for products data -->
    <!--<script src="./products.js" type="text/javascript"></script> -->
    <script src="./functions.js"></script>
    <script>
        var products_data;
        var total = 0;
        // Function is taken from Assignment 3 code example website: https://dport96.github.io/ITM352/morea/180.Assignment3/reading-code-examples.html
        loadJSON('get_products_data', function (response) {
            // Parsing JSON string into object
            products_data = JSON.parse(response);
        });
        // Function is taken from Assignment 3 code example website: https://dport96.github.io/ITM352/morea/180.Assignment3/reading-code-examples.html
        loadJSON('get_cart', function (response) {
            // Parsing JSON string into object
            shopping_cart = JSON.parse(response);
            for (pk in shopping_cart) {
                total += shopping_cart[pk].reduce((a, b) => a + b);
            }
        });

        // Code from W3 schools: https://www.w3schools.blog/get-cookie-by-name-javascript-js
        // Function gets browser cookies and returns cookie value(s)
        function getCookie(cookieName) {
            let cookie = {};
            document.cookie.split(';').forEach(function (el) {
                let [key, value] = el.split('=');
                cookie[key.trim()] = value;
            })
            return cookie[cookieName];
        }
        // Code from stack overflow: https://stackoverflow.com/questions/5968196/how-do-i-check-if-a-cookie-exists
        // Function checks if username cookie exists to display if a user is logged in or not. If logged in it displays their username
        function checkLogin() {
            var loginCookie = getCookie("username");

            if (loginCookie == null) {
                document.write(`<a href="/login" class="w3-bar-item w3-button w3-padding-16">Login/Register</a>`);
            }
            else {
                document.write(`
                            <a href="#" class="w3-bar-item w3-button w3-padding-16">Logged In: ${getCookie("username")}</a>
                            `);
            }
        }

        // Code from stack overflow: https://stackoverflow.com/questions/5968196/how-do-i-check-if-a-cookie-exists
        // Function checks if username cookie exists to display if a user is logged in or not. If logged in it displays their username
        function checkLogout() {
            var loginCookie = getCookie("username");

            if (loginCookie == null) {
                var nothing = "";
            }
            else {
                document.write(`
                            <a href="/logout" class="w3-bar-item w3-button ">Logout</a>
                            `);
            }
        }
    </script>
</head>

<!-- Form to submit to server -->


<body onload="cart_total.innerHTML = total;">

    <!-- Header -->
    <header class="w3-container w3-theme w3-padding" id="myHeader">
        <div class="w3-container">
            <div class="w3-bar w3-theme">
                <!-- Home button -->
                <a href="index.html" class="w3-bar-item w3-button w3-padding-16">Home</a>
                <!-- Mice dropdown to go to different mice product pages -->
                <div class="w3-dropdown-hover">
                    <button class="w3-button w3-padding-16">
                        Mice <i class="fa fa-caret-down"></i>
                    </button>
                    <!-- Mice product page links that checks the visitpage in server to assign current page -->
                    <div class="w3-dropdown-content w3-card-4 w3-bar-block">
                        <script>
                            document.write(`
                            <form action="/visitedpage" method"GET">
	                            <input type="hidden" name="visitingpage" value="Razer">
	                            <button class="w3-bar-item w3-button" type="submit" value="visit" name="Submit">Razer Mice</button>
                                </form>
                                <br>
                                <form action="/visitedpage" method"GET">
	                            <input type="hidden" name="visitingpage" value="Logitech">
	                            <button class="w3-bar-item w3-button" type="submit" value="visit" name="Submit">Logitech Mice</button>
                                </form>
                                <br>
                                <form action="/visitedpage" method"GET">
	                            <input type="hidden" name="visitingpage" value="Steelseries">
	                            <button class="w3-bar-item w3-button" type="submit" value="visit" name="Submit">Steelseries Mice</button>
                                </form>
                                `);

                        </script>

                    </div>
                </div>
                <p class="w3-right">
                    <a href='./cart.html'><i class="fa fa-shopping-cart w3-margin-right w3-xlarge"></i></a>
                    The are <span id="cart_total">0</span> items in cart
                    <script>
                        checkLogout();
                    </script>
                </p>
                <!-- Calls checkLogin function to allow checkout if user is logged in -->
                <script>
                    checkLogin();
                </script>

            </div>
        </div>
        <div class="w3-center">
            <h1 class="w3-xxxlarge w3-animate-bottom">Christopher's Mouse Store</h1>
        </div>
    </header>
    <!-- Brand Display -->
    <br><br><br><br>
    <div class="w3-center">
        <h1>At Chris's Mouse Store we aim to supply you with the latest and most competetive mice on the market!</h1>
        <p>
            <br>
        <h2>Click on a brand to start shopping!</h2>
        <script>
            document.write(`
            <form action="/visitedpage" method"GET">
	                            <input type="hidden" name="visitingpage" value="Razer">
	                            <button class="w3-button w3-theme" type="submit" value="visit" name="Submit">Razer Mice</button>
                                </form>
                                <br>
                                <form action="/visitedpage" method"GET">
	                            <input type="hidden" name="visitingpage" value="Logitech">
	                            <button class="w3-button w3-theme" type="submit" value="visit" name="Submit">Logitech Mice</button>
                                </form>
                                <br>
                                <form action="/visitedpage" method"GET">
	                            <input type="hidden" name="visitingpage" value="Steelseries">
	                            <button class="w3-button w3-theme" type="submit" value="visit" name="Submit">Steelseries Mice</button>
                                </form>
            `);
        </script>
        </p>
    </div>

    <br><br><br><br><br><br><br><br>

    <!-- Footer -->
    <footer class="w3-center w3-container w3-theme-dark w3-padding-16">
        <h3>Your one stop shop for computer mice!</h3>
    </footer>

</body>

</html>